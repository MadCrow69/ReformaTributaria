<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Diagnóstico Reforma Tributária</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      background-color: #004080;
      color: white;
      padding: 2rem;
      text-align: center;
    }

    main {
      max-width: 900px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }

    h2 {
      color: #004080;
      margin-top: 2rem;
    }

    label {
      display: block;
      margin: 1rem 0 0.5rem;
      font-weight: bold;
    }

    input, select, textarea {
      width: 100%;
      padding: 0.7rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    .inline-options {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .inline-options label {
      font-weight: normal;
    }

    .button {
      background-color: #004080;
      color: white;
      border: none;
      padding: 1rem 2rem;
      margin-top: 2rem;
      font-size: 1rem;
      border-radius: 10px;
      cursor: pointer;
    }

    .button:hover {
      background-color: #003060;
    }

    .success {
      color: green;
      margin-top: 1rem;
    }

    .error {
      color: red;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>📝 Diagnóstico de Impacto da Reforma Tributária</h1>
    <p>Forbiz | Evento Especial</p>
  </header>
  <main>
    <!-- Somente o trecho do formulário alterado -->
<form id="diagnosticoForm">
    <h2>1. Dados da empresa</h2>
    <label>📛 Razão social:</label><input type="text" name="razao_social" required value="Forbiz Soluções Ltda">
    <label>🏢 CNPJ:</label><input type="text" name="cnpj" required value="12.345.678/0001-90">
    <label>🌐 Website:</label><input type="url" name="website" value="https://www.forbiz.com.br">
    <label>📍 Cidade e Estado (Matriz):</label><input type="text" name="cidade_estado" value="São Paulo - SP">
    <label>👤 Responsável:</label><input type="text" name="responsavel" value="Carlos Silva">
    <label>📧 E-mail:</label><input type="email" name="email" value="carlos@forbiz.com.br">
    <label>📞 Telefone/WhatsApp:</label><input type="text" name="telefone" value="(11) 91234-5678">
  
    <h2>2. Estrutura e regime fiscal</h2>
    <label>💼 Setor principal:</label>
    <select name="setor">
      <option>Indústria</option>
      <option selected>Comércio</option>
      <option>Serviços</option>
      <option>Agropecuária</option>
      <option>Outro</option>
    </select>
    <label>💸 Regime tributário:</label>
    <select name="regime">
      <option selected>Simples Nacional</option>
      <option>Lucro Presumido</option>
      <option>Lucro Real</option>
    </select>
    <label>🧾 Média de faturamento:</label>
    <select name="faturamento">
      <option>Até R$ 4,8 milhões</option>
      <option selected>R$ 4,8 mi a R$ 78 mi</option>
      <option>Acima de R$ 78 milhões</option>
    </select>
    <label>🏭 Opera em mais de um estado?</label>
    <select name="multiestado"><option>Sim</option><option selected>Não</option></select>
    <label>🔁 Substituição tributária ou benefícios?</label>
    <select name="beneficios"><option selected>Sim</option><option>Não</option><option>Não sei</option></select>
    <label>🧮 Produtos com isenção ou alíquota zero?</label>
    <select name="isenção"><option>Sim</option><option selected>Não</option><option>Não sei</option></select>
  
    <h2>3. Operações e riscos</h2>
    <label>🔍 Já iniciou estudo sobre CBS/IBS?</label><select name="estudo"><option selected>Sim</option><option>Não</option></select>
    <label>📉 Usa créditos de PIS/COFINS?</label><select name="creditos"><option selected>Sim</option><option>Não</option><option>Não sei</option></select>
    <label>⚖️ Contratos com cláusulas de revisão?</label>
    <select name="clausulas"><option>Sim</option><option selected>Não</option><option>Parcialmente</option></select>
  
    <label>📦 Informe até 5 NCMs com descrição:</label>
    <div id="ncms">
      <input type="text" placeholder="NCM 1 – Produto" name="ncm1" value="8501.10.19 – Motor elétrico">
      <input type="text" placeholder="NCM 2 – Produto" name="ncm2" value="8414.59.90 – Compressor de ar">
      <input type="text" placeholder="NCM 3 – Produto" name="ncm3" value="8471.30.12 – Impressora térmica">
      <input type="text" placeholder="NCM 4 – Produto" name="ncm4" value="8536.69.10 – Tomada elétrica">
      <input type="text" placeholder="NCM 5 – Produto" name="ncm5" value="8544.42.00 – Cabo de energia">
    </div>
  
    <label>📈 Avaliação da carga tributária:</label>
    <select name="carga">
      <option selected>Muito elevada (acima de 20%)</option>
      <option>Elevada (15% a 20%)</option>
      <option>Moderada (10% a 15%)</option>
      <option>Baixa (até 10%)</option>
      <option>Não sei informar</option>
    </select>
    <label>💼 Contabilidade:</label>
    <select name="contabilidade"><option selected>Terceiriza</option><option>Equipe interna</option><option>Misto</option></select>
  
    <h2>4. Obrigações acessórias e tecnologia</h2>
    <label>🧠 Equipe preparada?</label><select name="preparacao"><option selected>Sim</option><option>Não</option><option>Parcialmente</option></select>
    <label>🖥️ Sistema ERP:</label>
    <select name="erp">
      <option selected>SENIOR SISTEMAS</option>
      <option>Outros</option>
      <option>Nenhum</option>
    </select>
    <label>🔧 Pretende atualizar o sistema?</label><select name="atualizar_sistema"><option selected>Sim</option><option>Não</option><option>Ainda não avaliado</option></select>
    <label>📑 Apuração de tributos:</label>
    <select name="apuracao"><option>Manual (Excel)</option><option selected>Semiautomática</option><option>Totalmente automatizada</option></select>
    <label>📂 Histórico de créditos?</label><select name="historico"><option selected>Sim</option><option>Não</option><option>Parcialmente</option></select>
    <label>🤝 Deseja relatório gratuito?</label><select name="relatorio"><option selected>Sim, quero receber</option><option>Não tenho interesse</option></select>
  
    <button type="submit" class="button">Enviar Diagnóstico</button>
    <div id="responseMsg"></div>
  </form>
  
  </main>

  <script>
    const form = document.getElementById('diagnosticoForm');
    const responseMsg = document.getElementById('responseMsg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        empresa: {
          razao_social: form.razao_social.value,
          cnpj: form.cnpj.value,
          website: form.website.value,
          cidade_estado: form.cidade_estado.value,
          responsavel: form.responsavel.value,
          email: form.email.value,
          telefone: form.telefone.value
        },
        estrutura_fiscal: {
          setor: form.setor.value,
          regime_tributario: form.regime.value,
          faturamento: form.faturamento.value,
          opera_em_outros_estados: form.multiestado.value,
          tem_regimes_especiais: form.beneficios.value,
          tem_produtos_isencao: form.isenção.value
        },
        operacoes_riscos: {
          estudo_cbs_ibs: form.estudo.value,
          utiliza_creditos_pis_cofins: form.creditos.value,
          clausulas_revisao: form.clausulas.value,
          ncms: [
            { codigo: form.ncm1.value.split("–")[0]?.trim(), produto: form.ncm1.value.split("–")[1]?.trim() },
            { codigo: form.ncm2.value.split("–")[0]?.trim(), produto: form.ncm2.value.split("–")[1]?.trim() },
            { codigo: form.ncm3.value.split("–")[0]?.trim(), produto: form.ncm3.value.split("–")[1]?.trim() },
            { codigo: form.ncm4.value.split("–")[0]?.trim(), produto: form.ncm4.value.split("–")[1]?.trim() },
            { codigo: form.ncm5.value.split("–")[0]?.trim(), produto: form.ncm5.value.split("–")[1]?.trim() },
          ],
          avaliacao_carga: form.carga.value,
          tipo_contabilidade: form.contabilidade.value
        },
        obrigacoes_tecnologia: {
          equipe_preparada: form.preparacao.value,
          erp: form.erp.value,
          atualizacao_sistema: form.atualizar_sistema.value,
          apuracao_tributos: form.apuracao.value,
          historico_creditos: form.historico.value,
          quer_relatorio: form.relatorio.value
        }
      };

      try {
        const res = await fetch('http://201.11.9.158:3375/reformatributaria', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          responseMsg.innerHTML = '<p class="success">✅ Diagnóstico enviado com sucesso!</p>';
          form.reset();
        } else {
          throw new Error('Erro ao enviar');
        }
      } catch (err) {
        responseMsg.innerHTML = '<p class="error">❌ Ocorreu um erro no envio. Tente novamente.</p>';
      }
    });
  </script>
</body>
</html>
